
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>slice与底层数组引用 - Chyroc的博客</title>
<meta property="og:title" content="blog.chyroc.cn" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Chyroc的博客" />
<meta property="og:description" content="Chyroc的博客" />
<link rel="canonical" href="blog.chyroc.cn" />
<meta property="og:url" content="blog.chyroc.cn" />
<meta property="og:site_name" content="blog.chyroc.cn" />
<script type="application/ld+json">
{"name":"blog.chyroc.cn","description":"Chyroc的博客","author":"Chyroc","@type":"WebSite","url":"blog.chyroc.cn","image":null,"publisher":null,"headline":"blog.chyroc.cn","dateModified":null,"datePublished":null,"sameAs":null,"mainEntityOfPage":null,"@context":"http://schema.org"}</script>


<link href="http://blog.chyroc.cn/assets/css/style.css" rel="stylesheet">
</head>
<body>
<div class="container-lg px-3 my-5 markdown-body">

<h1>
<a id="user-content-slice与底层数组引用" class="anchor" href="#slice%E4%B8%8E%E5%BA%95%E5%B1%82%E6%95%B0%E7%BB%84%E5%BC%95%E7%94%A8" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>slice与底层数组引用</h1>
<div class="highlight highlight-source-go"><pre><span class="pl-k">package</span> main

<span class="pl-k">import</span> (
	<span class="pl-s"><span class="pl-pds">"</span>fmt<span class="pl-pds">"</span></span>
)

<span class="pl-k">func</span> <span class="pl-en">main</span>() {
	<span class="pl-smi">s</span> <span class="pl-k">:=</span> []<span class="pl-k">int</span>{<span class="pl-c1">1</span>, <span class="pl-c1">2</span>, <span class="pl-c1">3</span>}
	<span class="pl-smi">ss</span> <span class="pl-k">:=</span> s[<span class="pl-c1">1</span>:]
	<span class="pl-k">for</span> <span class="pl-smi">i</span> <span class="pl-k">:=</span> <span class="pl-k">range</span> ss {
		ss[i] += <span class="pl-c1">10</span>
	}
	fmt.<span class="pl-c1">Println</span>(s)
	ss = <span class="pl-c1">append</span>(ss, <span class="pl-c1">4</span>)
	<span class="pl-k">for</span> <span class="pl-smi">i</span> <span class="pl-k">:=</span> <span class="pl-k">range</span> ss {
		ss[i] += <span class="pl-c1">10</span>
	}
	fmt.<span class="pl-c1">Println</span>(s)
}</pre></div>
<p>结果是</p>
<pre><code>[1 12 13]
[1 12 13]
</code></pre>
<p>也就是说第一个循环改变了s，第二个循环没有改变。</p>
<p>为什么会这样呢，因为在第一个循环中，s和ss都是slice，底层共用的是一个数组，所以改变ss的时候，实际上改变的是底层的数组，所以s也会跟着改变。</p>
<p>在第二个循环中，<code>ss = append(ss, 4)</code>这句话会将ss底层引用的数组改变，所以从这里开始s和ss就没有关联了。所以改变ss的时候，并不会改变s。</p>
<p>可以打印出slice的底层数组印证一下：</p>
<div class="highlight highlight-source-go"><pre><span class="pl-k">package</span> main

<span class="pl-k">import</span> (
	<span class="pl-s"><span class="pl-pds">"</span>fmt<span class="pl-pds">"</span></span>
	<span class="pl-s"><span class="pl-pds">"</span>reflect<span class="pl-pds">"</span></span>
	<span class="pl-s"><span class="pl-pds">"</span>unsafe<span class="pl-pds">"</span></span>
)

<span class="pl-k">func</span> <span class="pl-en">printArrayOfSlice</span>(<span class="pl-v">msg</span> <span class="pl-v">string</span>, <span class="pl-v">s</span> []<span class="pl-v">int</span>) {
	<span class="pl-smi">hdr</span> <span class="pl-k">:=</span> (*reflect.<span class="pl-smi">SliceHeader</span>)(unsafe.<span class="pl-c1">Pointer</span>(&amp;s))
	<span class="pl-smi">data</span> <span class="pl-k">:=</span> *(*[<span class="pl-c1">3</span>]<span class="pl-k">int</span>)(unsafe.<span class="pl-c1">Pointer</span>(hdr.<span class="pl-smi">Data</span>))
	fmt.<span class="pl-c1">Printf</span>(<span class="pl-s"><span class="pl-pds">"</span><span class="pl-c1">%s</span> <span class="pl-cce">\t</span>array<span class="pl-cce">\t</span><span class="pl-c1">%+v</span><span class="pl-cce">\n</span><span class="pl-pds">"</span></span>, msg, data)
}

<span class="pl-k">func</span> <span class="pl-en">main</span>() {
	<span class="pl-smi">s</span> <span class="pl-k">:=</span> []<span class="pl-k">int</span>{<span class="pl-c1">1</span>, <span class="pl-c1">2</span>, <span class="pl-c1">3</span>}
	<span class="pl-smi">ss</span> <span class="pl-k">:=</span> s[<span class="pl-c1">1</span>:]
	<span class="pl-k">for</span> <span class="pl-smi">i</span> <span class="pl-k">:=</span> <span class="pl-k">range</span> ss {
		ss[i] += <span class="pl-c1">10</span>
	}
	<span class="pl-c1">printArrayOfSlice</span>(<span class="pl-s"><span class="pl-pds">"</span>s<span class="pl-pds">"</span></span>, s)
	<span class="pl-c1">printArrayOfSlice</span>(<span class="pl-s"><span class="pl-pds">"</span>ss<span class="pl-pds">"</span></span>, ss)

	ss = <span class="pl-c1">append</span>(ss, <span class="pl-c1">4</span>)
	<span class="pl-k">for</span> <span class="pl-smi">i</span> <span class="pl-k">:=</span> <span class="pl-k">range</span> ss {
		ss[i] += <span class="pl-c1">10</span>
	}
	<span class="pl-c1">printArrayOfSlice</span>(<span class="pl-s"><span class="pl-pds">"</span>s<span class="pl-pds">"</span></span>, s)
	<span class="pl-c1">printArrayOfSlice</span>(<span class="pl-s"><span class="pl-pds">"</span>ss<span class="pl-pds">"</span></span>, ss)
}</pre></div>
<p>结果是</p>
<pre><code>s 	array	[1 12 13]
ss 	array	[12 13 842350739296]
s 	array	[1 12 13]
ss 	array	[22 23 14]
</code></pre>
<p>说明的我的想法：ss在前后所引用底层数组改变了。</p>


</div>

</body>
</html>
