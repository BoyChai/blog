
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>使用 修饰器+类 定义python的常量 - Chyroc的博客</title>
<meta property="og:title" content="blog.chyroc.cn" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Chyroc的博客" />
<meta property="og:description" content="Chyroc的博客" />
<link rel="canonical" href="blog.chyroc.cn" />
<meta property="og:url" content="blog.chyroc.cn" />
<meta property="og:site_name" content="blog.chyroc.cn" />
<script type="application/ld+json">
{"name":"blog.chyroc.cn","description":"Chyroc的博客","author":"Chyroc","@type":"WebSite","url":"blog.chyroc.cn","image":null,"publisher":null,"headline":"blog.chyroc.cn","dateModified":null,"datePublished":null,"sameAs":null,"mainEntityOfPage":null,"@context":"http://schema.org"}</script>


<link href="http://blog.chyroc.cn/assets/css/style.css" rel="stylesheet">
</head>
<body>
<div class="container-lg px-3 my-5 markdown-body">

<p>使用修饰器定义python的常量</p>
<h4>
<a id="user-content-起因" class="anchor" href="#%E8%B5%B7%E5%9B%A0" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>起因</h4>
<p>在一些函数中，我们有时候只想要指定的几个输入，但是在代码/函数 交给别人使用的时候，别人还需要看文档，甚至不知道该传什么值，这个有一点不友好。</p>
<p>所以，我们想在代码中定义一些常量，供代码使用者调用。</p>
<h4>
<a id="user-content-使用变量" class="anchor" href="#%E4%BD%BF%E7%94%A8%E5%8F%98%E9%87%8F" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>使用变量</h4>
<div class="highlight highlight-source-python"><pre><span class="pl-c"><span class="pl-c">#</span> const.py</span>

<span class="pl-c1">CAT</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>cat<span class="pl-pds">'</span></span>
<span class="pl-c1">DOG</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>dog<span class="pl-pds">'</span></span></pre></div>
<p>这个时候，我们就可以使用了</p>
<div class="highlight highlight-source-python"><pre><span class="pl-k">import</span> const

const.<span class="pl-c1">CAT</span></pre></div>
<p><a href="https://user-images.githubusercontent.com/15604894/28760675-45d32cbc-75db-11e7-8e93-3e3c5327a4dd.png" target="_blank" rel="nofollow"><img src="https://user-images.githubusercontent.com/15604894/28760675-45d32cbc-75db-11e7-8e93-3e3c5327a4dd.png" alt="image" style="max-width:100%;"></a></p>
<p>嗯。。。。。这个时候我们又有一个类型了</p>
<div class="highlight highlight-source-python"><pre><span class="pl-c"><span class="pl-c">#</span> const.py</span>

<span class="pl-c1">CAT</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>cat<span class="pl-pds">'</span></span>
<span class="pl-c1">DOG</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>dog<span class="pl-pds">'</span></span>

<span class="pl-c1">MAC</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>mac<span class="pl-pds">'</span></span>
<span class="pl-c1">WIN</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>windows<span class="pl-pds">'</span></span>
<span class="pl-c1">LINUX</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>linux<span class="pl-pds">'</span></span></pre></div>
<p>我们再来看一下</p>
<p><a href="https://user-images.githubusercontent.com/15604894/28760720-a1bf87f0-75db-11e7-9403-d708998dc6c7.png" target="_blank" rel="nofollow"><img src="https://user-images.githubusercontent.com/15604894/28760720-a1bf87f0-75db-11e7-9403-d708998dc6c7.png" alt="image" style="max-width:100%;"></a></p>
<p>？？？（黑人问号脸），改选哪一个，CAT是什么鬼？</p>
<h4>
<a id="user-content-使用类--property" class="anchor" href="#%E4%BD%BF%E7%94%A8%E7%B1%BB--property" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>使用类 + property</h4>
<p>现在的常量代码如下</p>
<pre lang="pyhton"><code># const.py


class _Animal(object):
    @property
    def cat(self):
        return 'cat'

    @property
    def dog(self):
        return 'dog'


class _Platform(object):
    @property
    def mac(self):
        return 'mac'

    @property
    def win(self):
        return 'windows'

    @property
    def linux(self):
        return 'linux'


Animal = _Animal()
Platform = _Platform()
</code></pre>
<p>使用：
<a href="https://user-images.githubusercontent.com/15604894/28760866-1311a2e8-75dd-11e7-9f23-ccd6ba55b4fc.png" target="_blank" rel="nofollow"><img src="https://user-images.githubusercontent.com/15604894/28760866-1311a2e8-75dd-11e7-9f23-ccd6ba55b4fc.png" alt="image" style="max-width:100%;"></a></p>
<p><a href="https://user-images.githubusercontent.com/15604894/28781552-0a0ebaae-763d-11e7-94c1-9ef31e507014.png" target="_blank" rel="nofollow"><img src="https://user-images.githubusercontent.com/15604894/28781552-0a0ebaae-763d-11e7-94c1-9ef31e507014.png" alt="image" style="max-width:100%;"></a></p>
<p>嗯。。很好，现在有了刚刚吐槽的 <code>分类</code> 的功能。</p>
<p>不过有一天，有一个二货改了你的常量！！！</p>
<div class="highlight highlight-source-python"><pre>const.Platform.mac <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>windows<span class="pl-pds">'</span></span></pre></div>
<p>你是不是是不是傻了？</p>
<p>不过这是不可能的，嘿嘿，因为没有设置 <code>@mac.setter</code>修饰器的方法！
<a href="https://user-images.githubusercontent.com/15604894/28760917-801eeb70-75dd-11e7-99ac-aa697e1bdc62.png" target="_blank" rel="nofollow"><img src="https://user-images.githubusercontent.com/15604894/28760917-801eeb70-75dd-11e7-99ac-aa697e1bdc62.png" alt="image" style="max-width:100%;"></a></p>
<p>但是呢，这里还有一个问题，就是这代码也太长了吧，为了定义一个常量，需要3行代码，假如有20个常量呢。。。不仅写起来麻烦，看代码也很烦啊！！</p>
<h4>
<a id="user-content-使用类修饰器" class="anchor" href="#%E4%BD%BF%E7%94%A8%E7%B1%BB%E4%BF%AE%E9%A5%B0%E5%99%A8" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>使用类修饰器</h4>
<div class="highlight highlight-source-python"><pre><span class="pl-c"><span class="pl-c">#</span> const.py</span>


<span class="pl-k">class</span> <span class="pl-en">_Platform</span>(<span class="pl-c1">object</span>):
    mac <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>mac<span class="pl-pds">'</span></span>
    windows <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>windows<span class="pl-pds">'</span></span>
    linux <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>linux<span class="pl-pds">'</span></span>


Platform <span class="pl-k">=</span> _Platform()</pre></div>
<p>代码是减了不少，但是值可以改变。所以为了避免这样的情况，需要给类加一个修饰器~</p>
<div class="highlight highlight-source-python"><pre><span class="pl-c"><span class="pl-c">#</span> const.py</span>

<span class="pl-k">from</span> functools <span class="pl-k">import</span> wraps


<span class="pl-k">def</span> <span class="pl-en">Const</span>(<span class="pl-smi"><span class="pl-smi">cls</span></span>):
    <span class="pl-en">@wraps</span>(<span class="pl-c1">cls</span>)
    <span class="pl-k">def</span> <span class="pl-en">new_setattr</span>(<span class="pl-smi"><span class="pl-smi">self</span></span>, <span class="pl-smi">name</span>, <span class="pl-smi">value</span>):
        <span class="pl-k">raise</span> <span class="pl-c1">Exception</span>(<span class="pl-s"><span class="pl-pds">'</span>const : <span class="pl-c1">{}</span> can not be changed<span class="pl-pds">'</span></span>.format(name))

    <span class="pl-c1">cls</span>.<span class="pl-c1">__setattr__</span> <span class="pl-k">=</span> new_setattr
    <span class="pl-k">return</span> <span class="pl-c1">cls</span>


<span class="pl-en">@Const</span>
<span class="pl-k">class</span> <span class="pl-en">_Platform</span>(<span class="pl-c1">object</span>):
    mac <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>mac<span class="pl-pds">'</span></span>
    windows <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>windows<span class="pl-pds">'</span></span>
    linux <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>linux<span class="pl-pds">'</span></span>


Platform <span class="pl-k">=</span> _Platform()</pre></div>
<p><a href="https://user-images.githubusercontent.com/15604894/28761366-969bd5fe-75e0-11e7-8435-bc67016bce6f.png" target="_blank" rel="nofollow"><img src="https://user-images.githubusercontent.com/15604894/28761366-969bd5fe-75e0-11e7-8435-bc67016bce6f.png" alt="image" style="max-width:100%;"></a></p>
<h4>
<a id="user-content-最终的代码" class="anchor" href="#%E6%9C%80%E7%BB%88%E7%9A%84%E4%BB%A3%E7%A0%81" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>最终的代码</h4>
<div class="highlight highlight-source-python"><pre><span class="pl-c"><span class="pl-c">#</span> const.py</span>

<span class="pl-k">from</span> functools <span class="pl-k">import</span> wraps


<span class="pl-k">def</span> <span class="pl-en">Const</span>(<span class="pl-smi"><span class="pl-smi">cls</span></span>):
    <span class="pl-en">@wraps</span>(<span class="pl-c1">cls</span>)
    <span class="pl-k">def</span> <span class="pl-en">new_setattr</span>(<span class="pl-smi"><span class="pl-smi">self</span></span>, <span class="pl-smi">name</span>, <span class="pl-smi">value</span>):
        <span class="pl-k">raise</span> <span class="pl-c1">Exception</span>(<span class="pl-s"><span class="pl-pds">'</span>const : <span class="pl-c1">{}</span> can not be changed<span class="pl-pds">'</span></span>.format(name))

    <span class="pl-c1">cls</span>.<span class="pl-c1">__setattr__</span> <span class="pl-k">=</span> new_setattr
    <span class="pl-k">return</span> <span class="pl-c1">cls</span>


<span class="pl-en">@Const</span>
<span class="pl-k">class</span> <span class="pl-en">_Animal</span>(<span class="pl-c1">object</span>):
    cat <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>cat<span class="pl-pds">'</span></span>
    dog <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>dog<span class="pl-pds">'</span></span>


<span class="pl-en">@Const</span>
<span class="pl-k">class</span> <span class="pl-en">_Platform</span>(<span class="pl-c1">object</span>):
    mac <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>mac<span class="pl-pds">'</span></span>
    windows <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>windows<span class="pl-pds">'</span></span>
    linux <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>linux<span class="pl-pds">'</span></span>


<span class="pl-en">@Const</span>
<span class="pl-k">class</span> <span class="pl-en">_Const</span>(<span class="pl-c1">object</span>):
    animal <span class="pl-k">=</span> _Animal()
    platform <span class="pl-k">=</span> _Platform()


<span class="pl-c1">CONST</span> <span class="pl-k">=</span> _Const()</pre></div>


</div>

</body>
</html>
