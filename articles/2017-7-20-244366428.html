
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>python的requests的中文乱码问题解决记 - Chyroc的博客</title>
<meta property="og:title" content="blog.chyroc.cn" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Chyroc的博客" />
<meta property="og:description" content="Chyroc的博客" />
<link rel="canonical" href="blog.chyroc.cn" />
<meta property="og:url" content="blog.chyroc.cn" />
<meta property="og:site_name" content="blog.chyroc.cn" />
<script type="application/ld+json">
{"name":"blog.chyroc.cn","description":"Chyroc的博客","author":"Chyroc","@type":"WebSite","url":"blog.chyroc.cn","image":null,"publisher":null,"headline":"blog.chyroc.cn","dateModified":null,"datePublished":null,"sameAs":null,"mainEntityOfPage":null,"@context":"http://schema.org"}</script>


<link href="http://blog.chyroc.cn/assets/css/style.css" rel="stylesheet">
</head>
<body>
<div class="container-lg px-3 my-5 markdown-body">

<p>参考文章：<a href="http://www.au92.com/archives/python-requests-chinese-improve-random-code.html" rel="nofollow">Python+Requests抓取中文乱码改进方案</a></p>
<p>还有这篇文章下的第一个评论</p>
<p>参考文章：<a href="http://liguangming.com/python-requests-ge-encoding-from-headers" rel="nofollow">Python+Requests编码识别Bug</a></p>
<p>添加代码如下</p>
<div class="highlight highlight-source-python"><pre><span class="pl-k">import</span> requests
r <span class="pl-k">=</span> requests.get(url)
<span class="pl-k">if</span> r.status_code <span class="pl-k">==</span> requests.codes.ok:
    r.encoding <span class="pl-k">=</span> get_encoding_from_reponse(r)
<span class="pl-k">return</span> r.text</pre></div>
<p>其中get_encoding_from_reponse函数是：</p>
<div class="highlight highlight-source-python"><pre><span class="pl-k">def</span> <span class="pl-en">get_encoding_from_reponse</span>(<span class="pl-smi">reponse</span>):
    encoding <span class="pl-k">=</span> requests.utils.get_encodings_from_content(reponse.text)
    <span class="pl-k">if</span> encoding:
        <span class="pl-k">return</span> encoding[<span class="pl-c1">0</span>]
    <span class="pl-k">else</span>:
        <span class="pl-k">return</span> requests.utils.get_encoding_from_headers(reponse.headers)
</pre></div>


</div>

</body>
</html>
